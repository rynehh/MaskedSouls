{
	"name": "Hoja de eventos 1",
	"events": [
		{
			"eventType": "include",
			"includeSheet": "mapa_procedural"
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "key-is-down",
					"objectClass": "Keyboard",
					"sid": 216739719348300,
					"parameters": {
						"key": 87
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "Player",
					"sid": 751172362014604,
					"parameters": {
						"instance-variable": "PlayerID",
						"comparison": 0,
						"value": "0"
					}
				}
			],
			"actions": [
				{
					"id": "simulate-control",
					"objectClass": "Player",
					"sid": 582631077202931,
					"behaviorType": "8Direction",
					"parameters": {
						"control": "up"
					}
				}
			],
			"sid": 487892527433425
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "key-is-down",
					"objectClass": "Keyboard",
					"sid": 625391674897602,
					"parameters": {
						"key": 65
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "Player",
					"sid": 709013238186356,
					"parameters": {
						"instance-variable": "PlayerID",
						"comparison": 0,
						"value": "0"
					}
				}
			],
			"actions": [
				{
					"id": "simulate-control",
					"objectClass": "Player",
					"sid": 425316522829086,
					"behaviorType": "8Direction",
					"parameters": {
						"control": "left"
					}
				}
			],
			"sid": 127490127698949
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "key-is-down",
					"objectClass": "Keyboard",
					"sid": 746657425834575,
					"parameters": {
						"key": 83
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "Player",
					"sid": 114068586012866,
					"parameters": {
						"instance-variable": "PlayerID",
						"comparison": 0,
						"value": "0"
					}
				}
			],
			"actions": [
				{
					"id": "simulate-control",
					"objectClass": "Player",
					"sid": 460148642340406,
					"behaviorType": "8Direction",
					"parameters": {
						"control": "down"
					}
				}
			],
			"sid": 558039808486429
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "key-is-down",
					"objectClass": "Keyboard",
					"sid": 559845587039818,
					"parameters": {
						"key": 68
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "Player",
					"sid": 291244283908271,
					"parameters": {
						"instance-variable": "PlayerID",
						"comparison": 0,
						"value": "0"
					}
				}
			],
			"actions": [
				{
					"id": "simulate-control",
					"objectClass": "Player",
					"sid": 868284559643527,
					"behaviorType": "8Direction",
					"parameters": {
						"control": "right"
					}
				}
			],
			"sid": 147990751973091
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "key-is-down",
					"objectClass": "Keyboard",
					"sid": 801019670032594,
					"parameters": {
						"key": 73
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "Player",
					"sid": 775119249513466,
					"parameters": {
						"instance-variable": "PlayerID",
						"comparison": 0,
						"value": "1"
					}
				}
			],
			"actions": [
				{
					"id": "simulate-control",
					"objectClass": "Player",
					"sid": 124710212966456,
					"behaviorType": "8Direction",
					"parameters": {
						"control": "up"
					}
				}
			],
			"sid": 550125894356056
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "key-is-down",
					"objectClass": "Keyboard",
					"sid": 611236707289966,
					"parameters": {
						"key": 74
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "Player",
					"sid": 826451824053001,
					"parameters": {
						"instance-variable": "PlayerID",
						"comparison": 0,
						"value": "1"
					}
				}
			],
			"actions": [
				{
					"id": "simulate-control",
					"objectClass": "Player",
					"sid": 591176899941734,
					"behaviorType": "8Direction",
					"parameters": {
						"control": "left"
					}
				},
				{
					"id": "set-mirrored",
					"objectClass": "Player",
					"sid": 872224401272711,
					"parameters": {
						"state": "not-mirrored"
					}
				}
			],
			"sid": 477944807872733
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "key-is-down",
					"objectClass": "Keyboard",
					"sid": 275116082828731,
					"parameters": {
						"key": 75
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "Player",
					"sid": 100387786835092,
					"parameters": {
						"instance-variable": "PlayerID",
						"comparison": 0,
						"value": "1"
					}
				}
			],
			"actions": [
				{
					"id": "simulate-control",
					"objectClass": "Player",
					"sid": 163976272844672,
					"behaviorType": "8Direction",
					"parameters": {
						"control": "down"
					}
				}
			],
			"sid": 114825730640813
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "key-is-down",
					"objectClass": "Keyboard",
					"sid": 694277674009766,
					"parameters": {
						"key": 76
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "Player",
					"sid": 575759959995582,
					"parameters": {
						"instance-variable": "PlayerID",
						"comparison": 0,
						"value": "1"
					}
				}
			],
			"actions": [
				{
					"id": "simulate-control",
					"objectClass": "Player",
					"sid": 848081288019850,
					"behaviorType": "8Direction",
					"parameters": {
						"control": "right"
					}
				},
				{
					"id": "set-mirrored",
					"objectClass": "Player",
					"sid": 676447761383528,
					"parameters": {
						"state": "mirrored"
					}
				}
			],
			"sid": 439964318600490
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-collision-with-another-object",
					"objectClass": "Player",
					"sid": 516745357689734,
					"parameters": {
						"object": "Mask"
					}
				}
			],
			"actions": [
				{
					"type": "script",
					"language": "typescript",
					"script": [
						"const { updatePlayerStats } = await import(\"./main.js\");",
						"",
						"const players = runtime.objects.Player.getAllInstances();",
						"const masks = runtime.objects.Mask.getAllInstances();",
						"",
						"for (const p of players) {",
						"    const mask = masks.find(m => p.testOverlap(m));",
						"    ",
						"    if (mask) {",
						"        updatePlayerStats(p, mask.instVars.MaskID);",
						"        mask.destroy();",
						"        console.log(`Jugador ${p.instVars.PlayerID} agarrÃ³ mascara: ${mask.instVars.MaskID}`);",
						"    }",
						"}"
					]
				}
			],
			"sid": 370288435426745
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-collision-with-another-object",
					"objectClass": "Bullet_Type",
					"sid": 785304042229788,
					"parameters": {
						"object": "Enemy"
					}
				}
			],
			"actions": [
				{
					"type": "script",
					"language": "typescript",
					"script": [
						"const bullets = runtime.objects.Bullet_Type.getAllInstances();",
						"const enemies = runtime.objects.Enemy.getAllInstances();",
						"",
						"for (const b of bullets) {",
						"    const enemy = enemies.find(e => b.testOverlap(e));",
						"",
						"    if (!enemy || b.instVars.IgnoreUID === enemy.uid) continue;",
						"",
						"    const maskType = b.instVars.ActiveMask || \"Normal\"; ",
						"",
						"    enemy.instVars.HP -= b.instVars.Damage;",
						"    console.log(`[${maskType}] HPEnemy`, enemy.instVars.HP);",
						"    b.destroy();",
						"",
						"    if (maskType === \"Fuego\") {",
						"        enemy.behaviors.Timer.startTimer(3, \"burn\", \"regular\"); ",
						"        enemy.instVars.BurnTicks = 6;",
						"    } ",
						"    else if (maskType === \"Hielo\") {",
						"        enemy.instVars.IsFrozen = true;",
						"        enemy.colorRgb = [100, 100, 255];",
						"        enemy.behaviors.Timer.startTimer(3, \"Thaw\");",
						"    }",
						"    else if (maskType === \"Rayo\" && b.instVars.Bounces > 0) {",
						"        const target = enemies",
						"            .filter(e => e !== enemy) ",
						"            .sort((a, bDist) => Math.hypot(a.x - enemy.x, a.y - enemy.y) - Math.hypot(bDist.x - enemy.x, bDist.y - enemy.y))[0];",
						"        ",
						"        if (target && Math.hypot(target.x - enemy.x, target.y - enemy.y) < 1000) {",
						"            const angleToTarget = Math.atan2(target.y - enemy.y, target.x - enemy.x);",
						"            const chain = runtime.objects.Bullet_Type.createInstance(\"Layer 0\", enemy.x, enemy.y) as any;",
						"            ",
						"            chain.angle = angleToTarget;",
						"            if (chain.behaviors.Bullet) chain.behaviors.Bullet.angle = angleToTarget;",
						"            ",
						"            chain.instVars.IgnoreUID = enemy.uid;      ",
						"            chain.instVars.Bounces = b.instVars.Bounces - 1; ",
						"            chain.instVars.Damage = b.instVars.Damage;",
						"            chain.instVars.ActiveMask = maskType; ",
						"            chain.instVars.OwnerUID = b.instVars.OwnerUID; ",
						"        }",
						"    }",
						"    else if (maskType === \"Peste\") {",
						"        runtime.objects.VenomPool.createInstance(\"Layer 0\", enemy.x, enemy.y);",
						"    }",
						"    else if (maskType === \"Luz\") {",
						"        const owner = runtime.objects.Player.getAllInstances().find(p => p.uid === b.instVars.OwnerUID);",
						"        if (owner) {",
						"             owner.instVars.HP = Math.min(1000, owner.instVars.HP + 5);",
						"        }",
						"    }",
						"",
						"    if (enemy.instVars.HP <= 0) enemy.destroy();",
						"}"
					]
				}
			],
			"sid": 949545479637660
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-collision-with-another-object",
					"objectClass": "Enemy_Bullet",
					"sid": 528499721185937,
					"parameters": {
						"object": "Player"
					}
				}
			],
			"actions": [
				{
					"type": "script",
					"language": "typescript",
					"script": [
						"const bullets = runtime.objects.Enemy_Bullet.getAllInstances();",
						"const players = runtime.objects.Player.getAllInstances();",
						"",
						"for (const b of bullets) {",
						"    const victim = players.find(p => b.testOverlap(p));",
						"",
						"    if (victim) {",
						"        victim.instVars.HP -= b.instVars.Damage;",
						"        b.destroy();",
						"        console.log(`HP Player ${victim.instVars.PlayerID}:`, victim.instVars.HP);",
						"",
						"        if (victim.instVars.HP <= 0) {",
						"            victim.destroy();",
						"            if (runtime.objects.Player.getAllInstances().length === 0) {",
						"                console.log(\"GAME OVER - Todos murieron\");",
						"            }",
						"        }",
						"    }",
						"}"
					]
				}
			],
			"sid": 285350013533534
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-timer",
					"objectClass": "Enemy",
					"sid": 689037994954928,
					"behaviorType": "Timer",
					"parameters": {
						"tag": "\"Thaw\""
					}
				}
			],
			"actions": [
				{
					"id": "set-enabled",
					"objectClass": "Enemy",
					"sid": 550391407629566,
					"behaviorType": "8Direction",
					"parameters": {
						"state": "enabled"
					}
				},
				{
					"id": "set-boolean-instvar",
					"objectClass": "Enemy",
					"sid": 728602519853215,
					"parameters": {
						"instance-variable": "IsFrozen",
						"value": "false"
					}
				}
			],
			"sid": 655156068806247
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-timer",
					"objectClass": "Enemy",
					"sid": 600089371788644,
					"behaviorType": "Timer",
					"parameters": {
						"tag": "\"Burn\""
					}
				}
			],
			"actions": [
				{
					"id": "subtract-from-instvar",
					"objectClass": "Enemy",
					"sid": 194242153244390,
					"parameters": {
						"instance-variable": "HP",
						"value": "3"
					}
				},
				{
					"id": "subtract-from-instvar",
					"objectClass": "Enemy",
					"sid": 252891812889862,
					"parameters": {
						"instance-variable": "BurnTicks",
						"value": "1"
					}
				}
			],
			"sid": 266909098762248
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "compare-instance-variable",
					"objectClass": "Enemy",
					"sid": 422212436681834,
					"parameters": {
						"instance-variable": "BurnTicks",
						"comparison": 3,
						"value": "0"
					}
				}
			],
			"actions": [
				{
					"id": "stop-timer",
					"objectClass": "Enemy",
					"sid": 160127771833586,
					"behaviorType": "Timer",
					"parameters": {
						"tag": "\"Burn\""
					}
				}
			],
			"sid": 636719864925108
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-collision-with-another-object",
					"objectClass": "VenomPool",
					"sid": 101317417509220,
					"parameters": {
						"object": "Enemy"
					}
				}
			],
			"actions": [
				{
					"id": "start-timer",
					"objectClass": "VenomPool",
					"sid": 727810099351931,
					"behaviorType": "Timer",
					"parameters": {
						"duration": "3",
						"type": "once",
						"tag": "\"Venom\""
					}
				}
			],
			"sid": 302203150977346
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-timer",
					"objectClass": "VenomPool",
					"sid": 589603572909845,
					"behaviorType": "Timer",
					"parameters": {
						"tag": "\"Venom\""
					}
				}
			],
			"actions": [
				{
					"id": "subtract-from-instvar",
					"objectClass": "Enemy",
					"sid": 927723237119348,
					"parameters": {
						"instance-variable": "HP",
						"value": "2"
					}
				},
				{
					"id": "destroy",
					"objectClass": "VenomPool",
					"sid": 559035869788748
				}
			],
			"sid": 216880227836587
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-start-of-layout",
					"objectClass": "System",
					"sid": 551794033339101
				}
			],
			"actions": [],
			"sid": 600924287435987,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 303810462372414,
							"parameters": {
								"variable": "GameMode",
								"comparison": 0,
								"value": "1"
							}
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "CorazonUI",
							"sid": 465290979960204,
							"parameters": {
								"instance-variable": "PlayerID",
								"comparison": 0,
								"value": "1"
							}
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "TxtPuntaje",
							"sid": 771869660055370,
							"parameters": {
								"instance-variable": "PlayerID",
								"comparison": 0,
								"value": "1"
							}
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "TxtNombreMascara",
							"sid": 454276662498990,
							"parameters": {
								"instance-variable": "PlayerID",
								"comparison": 0,
								"value": "1"
							}
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "MarcoUI",
							"sid": 486822166371819,
							"parameters": {
								"instance-variable": "PlayerID",
								"comparison": 0,
								"value": "1"
							}
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "Player",
							"sid": 642271498042408,
							"parameters": {
								"instance-variable": "PlayerID",
								"comparison": 0,
								"value": "1"
							}
						}
					],
					"actions": [
						{
							"id": "destroy",
							"objectClass": "Player",
							"sid": 179760381711522
						},
						{
							"id": "destroy",
							"objectClass": "CorazonUI",
							"sid": 786117569399482
						},
						{
							"id": "destroy",
							"objectClass": "MarcoUI",
							"sid": 611877196602641
						},
						{
							"id": "destroy",
							"objectClass": "TxtPuntaje",
							"sid": 676682446984398
						},
						{
							"id": "destroy",
							"objectClass": "TxtNombreMascara",
							"sid": 811274649674103
						}
					],
					"sid": 783876143442938
				}
			]
		}
	],
	"sid": 570815279696549
}